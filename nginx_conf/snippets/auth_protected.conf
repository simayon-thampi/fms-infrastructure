# Auth request and user context extraction
auth_request /auth;
auth_request_set $user_id     $upstream_http_x_user_id;
auth_request_set $user_email  $upstream_http_x_user_email;
auth_request_set $user_roles  $upstream_http_x_roles;
auth_request_set $user_scopes $upstream_http_x_scopes;

# Forward user context to backend
proxy_set_header X-User-Id    $user_id;
proxy_set_header X-User-Email $user_email;
proxy_set_header X-Roles      $user_roles;
proxy_set_header X-Scopes     $user_scopes;
proxy_set_header Cookie        $http_cookie;
proxy_set_header Authorization $auth_bearer;
